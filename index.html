<!DOCTYPE html>
<html>
<head>
    <title>PDF Voice Reader</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #pdf-viewer { width: 100%; height: 300px; border: 1px solid #ccc; margin: 10px 0; padding: 10px; overflow-y: auto; }
        .controls { display: flex; gap: 10px; flex-wrap: wrap; }
        button { padding: 10px; background: #007bff; color: white; border: none; border-radius: 5px; }
        input[type="file"] { margin: 10px 0; }
    </style>
</head>
<body>
    <h2>PDF Voice Reader</h2>
    <input type="file" id="pdfInput" accept="application/pdf">
    <div id="pdf-viewer"></div>
    <div class="controls">
        <button onclick="playPause()">▶️/⏸️</button>
        <button onclick="stop()">⏹️</button>
        <label>Speed:
            <select id="speed" onchange="changeSpeed()">
                <option value="0.5">0.5x</option>
                <option value="1" selected>1x</option>
                <option value="1.5">1.5x</option>
                <option value="2">2x</option>
            </select>
        </label>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
    <script>
        let synth = window.speechSynthesis;
        let utterance = null;
        let currentText = '';
        let pausedPosition = 0;

        document.getElementById('pdfInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    readPDF(e.target.result);
                };
                reader.readAsArrayBuffer(file);
            }
        });

        async function readPDF(data) {
            const pdf = await pdfjsLib.getDocument({ data }).promise;
            let text = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(item => item.str).join(' ');
            }
            currentText = text;
            document.getElementById('pdf-viewer').textContent = text;
        }

        function playPause() {
            if (!synth.speaking && !synth.paused) {
                utterance = new SpeechSynthesisUtterance(currentText);
                utterance.rate = document.getElementById('speed').value;
                synth.speak(utterance);
            } else if (synth.speaking && !synth.paused) {
                synth.pause();
                pausedPosition = synth.currentTextCharIndex;
            } else if (synth.paused) {
                synth.resume();
            }
        }

        function stop() {
            synth.cancel();
            pausedPosition = 0;
        }

        function changeSpeed() {
            if (synth.speaking && utterance) {
                utterance.rate = document.getElementById('speed').value;
                synth.pause();
                synth.resume();
            }
        }
    </script>
</body>
</html>
